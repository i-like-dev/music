<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>YouTube 播放計時器</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      text-align: center;
      padding: 20px;
    }
    input {
      padding: 10px;
      font-size: 16px;
      width: 300px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-left: 10px;
      cursor: pointer;
    }
    #player, #controls {
      margin-top: 20px;
    }
    #timer {
      font-size: 20px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>YouTube 播放計時器</h1>
  <input id="videoIdInput" placeholder="輸入 YouTube 影片 ID 或網址">
  <button id="playBtn">播放</button>

  <div id="player"></div>
  <div id="controls" style="display:none;">
    <div id="timer">0:00 / 0:00</div>
  </div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player;
    let duration = 0;
    let timerInterval = null;

    function extractVideoId(input) {
      const regex = /(?:v=|\/)([0-9A-Za-z_-]{11}).*/;
      const match = input.match(regex);
      return match ? match[1] : input;
    }

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '360',
        width: '640',
        videoId: '',
        events: {
          'onReady': onPlayerReady
        },
        playerVars: {
          controls: 1,
          modestbranding: 1,
        }
      });
    }

    function onPlayerReady(event) {
      document.getElementById('playBtn').onclick = function () {
        const input = document.getElementById('videoIdInput').value.trim();
        const videoId = extractVideoId(input);

        if (!videoId) return alert("請輸入有效的影片 ID 或網址");

        player.loadVideoById(videoId);
        clearInterval(timerInterval);
        document.getElementById('controls').style.display = 'block';

        // 等待 metadata 載入
        setTimeout(() => {
          duration = player.getDuration();
          updateTime(); // 立即更新一次
          timerInterval = setInterval(() => {
            const current = player.getCurrentTime();
            updateTime(current, duration);

            if (current >= duration) {
              clearInterval(timerInterval);
              document.getElementById("videoIdInput").value = "";
            }
          }, 500);
        }, 1000);
      };
    }

    function updateTime(current = 0, total = 0) {
      const formatTime = t => {
        const min = Math.floor(t / 60);
        const sec = Math.floor(t % 60).toString().padStart(2, '0');
        return `${min}:${sec}`;
      };
      document.getElementById('timer').textContent = `${formatTime(current)} / ${formatTime(total)}`;
    }
  </script>
</body>
</html>
