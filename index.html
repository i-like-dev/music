<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>YouTube Playlist 播放器（隱藏影片）</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #eee;
    padding: 20px;
    max-width: 600px;
    margin: auto;
  }
  h1 {
    text-align: center;
    margin-bottom: 1rem;
  }
  #player {
    width: 0;
    height: 0;
    position: absolute;
    left: -9999px; /* 隱藏影片 */
  }
  #playlist {
    list-style: none;
    padding: 0;
    max-height: 320px;
    overflow-y: auto;
    margin-bottom: 1rem;
    border: 1px solid #333;
    border-radius: 8px;
  }
  #playlist li {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #222;
  }
  #playlist li.active {
    background: #00bcd4;
    color: #000;
    font-weight: bold;
  }
  .controls {
    text-align: center;
    margin-bottom: 1rem;
  }
  .controls button {
    background: #00bcd4;
    border: none;
    color: #000;
    padding: 10px 15px;
    margin: 0 8px;
    border-radius: 6px;
    font-weight: bold;
    cursor: pointer;
  }
  label {
    display: inline-block;
    margin-right: 8px;
  }
  input[type=range] {
    vertical-align: middle;
    width: 150px;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>

<h1>YouTube 播放清單播放器（隱藏影片）</h1>

<ul id="playlist">載入中...</ul>

<div class="controls">
  <button id="prevBtn">上一首</button>
  <button id="playPauseBtn">播放</button>
  <button id="nextBtn">下一首</button>
  <label for="volumeRange">音量</label>
  <input type="range" id="volumeRange" min="0" max="100" value="50" />
</div>

<!-- 隱藏影片iframe -->
<div id="player"></div>

<script>
  let player;
  let currentIndex = 0;
  let isPlaying = false;
  const playlistElement = document.getElementById('playlist');
  const playPauseBtn = document.getElementById('playPauseBtn');
  const volumeRange = document.getElementById('volumeRange');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');

  // 你的 YouTube 播放清單ID
  const PLAYLIST_ID = 'PL9tY0BWXOZFtrv_7QTTv3zp8g5Q1KEEyA'; // 請改成你自己的播放清單ID

  // 請填入你的 YouTube Data API Key
  const API_KEY = 'AIzaSyDvtH4xw6YTdnfS9jZ2P0MrwX_1UrG_GV8';

  // 先用 API 抓播放清單的影片清單和標題
  async function fetchPlaylistVideos(playlistId) {
    let videos = [];
    let nextPageToken = '';
    do {
      const res = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${playlistId}&key=${API_KEY}&pageToken=${nextPageToken}`);
      const data = await res.json();
      if (data.error) {
        alert('取得播放清單錯誤: ' + data.error.message);
        return [];
      }
      videos.push(...data.items);
      nextPageToken = data.nextPageToken || '';
    } while (nextPageToken);
    return videos.map(item => ({
      videoId: item.snippet.resourceId.videoId,
      title: item.snippet.title
    }));
  }

  // 初始化 YouTube Player API
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '0',
      width: '0',
      playerVars: {
        'playsinline': 1,
        'controls': 0,
        'disablekb': 1,
        'modestbranding': 1,
        'rel': 0
      },
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  function onPlayerReady(event) {
    player.setVolume(volumeRange.value);
    renderPlaylist();
    loadVideo(currentIndex);
  }

  function onPlayerStateChange(event) {
    if(event.data === YT.PlayerState.ENDED) {
      next();
    }
  }

  function renderPlaylist() {
    playlistElement.innerHTML = '';
    videos.forEach((video, idx) => {
      const li = document.createElement('li');
      li.textContent = video.title;
      li.dataset.index = idx;
      if (idx === currentIndex) li.classList.add('active');
      li.addEventListener('click', () => {
        loadVideo(idx);
        play();
      });
      playlistElement.appendChild(li);
    });
  }

  function loadVideo(index) {
    currentIndex = index;
    const video = videos[index];
    player.loadVideoById(video.videoId);
    updateActiveItem();
  }

  function updateActiveItem() {
    const lis = playlistElement.querySelectorAll('li');
    lis.forEach(li => li.classList.remove('active'));
    const currentLi = playlistElement.querySelector(`li[data-index="${currentIndex}"]`);
    if (currentLi) currentLi.classList.add('active');
  }

  function play() {
    player.playVideo();
    isPlaying = true;
    playPauseBtn.textContent = '暫停';
  }

  function pause() {
    player.pauseVideo();
    isPlaying = false;
    playPauseBtn.textContent = '播放';
  }

  function togglePlayPause() {
    if (!player) return;
    if (isPlaying) pause();
    else play();
  }

  function next() {
    currentIndex = (currentIndex + 1) % videos.length;
    loadVideo(currentIndex);
    play();
  }

  function prev() {
    currentIndex = (currentIndex - 1 + videos.length) % videos.length;
    loadVideo(currentIndex);
    play();
  }

  volumeRange.addEventListener('input', () => {
    if(player) player.setVolume(volumeRange.value);
  });

  playPauseBtn.addEventListener('click', togglePlayPause);
  nextBtn.addEventListener('click', next);
  prevBtn.addEventListener('click', prev);

  let videos = [];

  async function start() {
    videos = await fetchPlaylistVideos(PLAYLIST_ID);
    if(videos.length === 0) {
      playlistElement.innerHTML = '<li>播放清單讀取失敗</li>';
      return;
    }
    // YouTube Iframe API 載入會呼叫 onYouTubeIframeAPIReady
  }

  // 載入 YouTube Iframe API
  let tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  document.head.appendChild(tag);

  window.onYouTubeIframeAPIReady = function() {
    onYouTubeIframeAPIReady();
  }

  start();
</script>

</body>
</html>
