<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>🎵 音樂播放器 🎶</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap" rel="stylesheet" />
<style>
  body {
    font-family: 'Noto Sans TC', sans-serif;
    background: #fff;
    color: #222;
    text-align: center;
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    user-select: none;
    transition: background-color 0.3s ease, color 0.3s ease;
  }
  h1 {
    font-size: 2.4rem;
    margin-bottom: 1rem;
    font-weight: normal;
  }
  #time, #idleTime {
    font-weight: 400;
    margin-bottom: 20px;
    color: #555;
  }
  #time {
    font-size: 1.1rem;
  }
  #idleTime {
    font-size: 5rem;
    display: none;
    user-select: none;
    background: rgba(255, 255, 255, 0.8);
    color: #000;
    padding: 20px 0;
    border-radius: 12px;
  }
  #player {
    width: 0;
    height: 0;
    position: absolute;
    left: -9999px;
  }
  #playlist {
    list-style: none;
    padding: 0;
    max-height: 300px;
    overflow-y: auto;
    margin-bottom: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
  }
  #playlist li {
    background: #f0f8ff;
    border: 1px solid #0088ff;
    border-radius: 10px;
    padding: 12px 16px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 400;
    width: calc(50% - 12px);
    box-sizing: border-box;
    transition: background-color 0.3s ease, color 0.3s ease;
    color: #0088ff;
    user-select: none;
  }
  #playlist li:hover {
    background-color: #cce6ff;
  }
  #playlist li.active {
    background-color: #0088ff;
    color: white;
  }
  .controls {
    margin-bottom: 15px;
  }
  .controls button {
    background-color: #0088ff;
    border: none;
    color: white;
    padding: 12px 20px;
    margin: 0 7px 10px 7px;
    border-radius: 12px;
    cursor: pointer;
    font-size: 1.1rem;
    font-weight: 700;
    box-shadow: 0 4px 10px rgb(0 136 255 / 0.5);
    transition: background-color 0.3s ease;
    user-select: none;
  }
  .controls button:hover {
    background-color: #006fcc;
  }
  label {
    font-weight: 600;
    vertical-align: middle;
  }
  #volumeContainer {
    margin-top: 8px;
  }
  input[type=range] {
    vertical-align: middle;
    width: 100%;
    max-width: 300px;
    cursor: pointer;
    margin-top: 6px;
  }
  #progressContainer {
    margin: 15px 0 25px;
  }
  #progress {
    width: 100%;
    height: 12px;
    -webkit-appearance: none;
    appearance: none;
    background: #e2e2e2;
    border-radius: 10px;
    cursor: pointer;
  }
  #progress::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background: #0088ff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 5px #006fcc;
    margin-top: -4px;
  }
  #progress::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: #0088ff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 5px #006fcc;
  }
  #autoPauseContainer {
    margin-top: 20px;
    font-size: 0.95rem;
    color: #444;
    user-select: none;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
  }
  #autoPauseContainer input[type=number] {
    width: 50px;
    padding: 4px;
    border-radius: 6px;
    border: 1px solid #ccc;
    text-align: center;
  }
  #autoPauseContainer button {
    background: none;
    border: none;
    font-size: 1.6rem;
    cursor: pointer;
    user-select: none;
    transition: color 0.3s ease;
    padding: 0 6px;
  }
  #autoPauseContainer button:hover {
    color: #0088ff;
  }
  #currentTimeDisplay {
    font-weight: 400;
    font-size: 1rem;
    margin-bottom: 10px;
    color: #333;
    user-select: none;
  }
</style>
</head>
<body>

<h1>🎵 音樂播放器 🎶</h1>
<div id="time">⌚ 現在時間：--:--:--</div>
<div id="idleTime"></div>

<ul id="playlist">載入中…</ul>

<div class="controls">
  <button id="prevBtn">⏮️ 上一首</button>
  <button id="playPauseBtn">▶️ 播放</button>
  <button id="nextBtn">⏭️ 下一首</button>
  <button id="fullscreenBtn">🖥️ 全螢幕</button>
  
  <div id="volumeContainer">
    <label for="volumeRange">🔊 音量</label><br/>
    <input type="range" id="volumeRange" min="0" max="100" value="50" />
  </div>
</div>

<div id="progressContainer">
  <input type="range" id="progress" min="0" max="100" value="0" />
  <div id="currentTimeDisplay">00:00:00 / 00:00:00</div>
</div>

<div id="autoPauseContainer">
  ⏸️ 自動暫停時間：
  <input type="number" id="autoPauseHour" min="0" max="23" value="0" /> 小時
  <input type="number" id="autoPauseMinute" min="0" max="59" value="0" /> 分鐘
  <input type="number" id="autoPauseSecond" min="0" max="59" value="0" /> 秒
  <button id="startAutoPauseBtn" title="開始倒數">⚙️</button>
</div>

<div id="player"></div>

<script>
  const PLAYLIST_ID = 'PL4Ty6N3yT5CLyiCIDeHaDqNUgFEXWr9oW';
  const API_KEY = 'AIzaSyAcViF7zlpVqJH20M1RucGmt7RoIb_isuA';

  let player;
  let currentIndex = 0;
  let isPlaying = false;
  let autoPauseTimer = null;
  let countdownInterval = null;

  const playlistElement = document.getElementById('playlist');
  const playPauseBtn = document.getElementById('playPauseBtn');
  const volumeRange = document.getElementById('volumeRange');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const timeElement = document.getElementById('time');
  const idleTimeElement = document.getElementById('idleTime');
  const progress = document.getElementById('progress');
  const currentTimeDisplay = document.getElementById('currentTimeDisplay');
  const fullscreenBtn = document.getElementById('fullscreenBtn');

  const autoPauseHour = document.getElementById('autoPauseHour');
  const autoPauseMinute = document.getElementById('autoPauseMinute');
  const autoPauseSecond = document.getElementById('autoPauseSecond');
  const startAutoPauseBtn = document.getElementById('startAutoPauseBtn');

  let videos = [];

  // Idle mode (待機模式)
  let idleTimeout = null;
  const IDLE_DELAY = 60000;
  let isIdle = false;

  function resetIdleTimer() {
    if (isIdle) {
      exitIdleMode();
    }
    clearTimeout(idleTimeout);
    idleTimeout = setTimeout(enterIdleMode, IDLE_DELAY);
  }

  function enterIdleMode() {
    isIdle = true;
    document.body.style.backgroundColor = 'rgba(255,255,255,0.8)';
    document.body.style.color = '#000';

    playlistElement.style.display = 'none';
    document.querySelector('.controls').style.display = 'none';
    progress.style.display = 'none';
    timeElement.style.display = 'none';
    currentTimeDisplay.style.display = 'none';

    idleTimeElement.style.display = 'block';
    idleTimeElement.style.background = 'transparent';
    idleTimeElement.style.color = '#000';
  }

  function exitIdleMode() {
    isIdle = false;
    document.body.style.backgroundColor = '#fff';
    document.body.style.color = '#222';
    playlistElement.style.display = '';
    document.querySelector('.controls').style.display = '';
    progress.style.display = '';
    timeElement.style.display = '';
    currentTimeDisplay.style.display = '';

    idleTimeElement.style.display = 'none';
  }

  document.addEventListener('mousemove', resetIdleTimer);
  document.addEventListener('keydown', resetIdleTimer);
  resetIdleTimer();

  function updateIdleTime() {
    if (!isIdle) return;
    const now = new Date();
    const hh = String(now.getHours()).padStart(2, '0');
    const mm = String(now.getMinutes()).padStart(2, '0');
    const ss = String(now.getSeconds()).padStart(2, '0');
    idleTimeElement.textContent = `🕒 ${hh}:${mm}:${ss}`;
  }
  setInterval(updateIdleTime, 1000);

  // YouTube API Load
  function onYouTubeIframeAPIReady() {
    loadPlaylist();
  }

  async function loadPlaylist() {
    try {
      const response = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=50&playlistId=${PLAYLIST_ID}&key=${API_KEY}`);
      const data = await response.json();
      videos = data.items.map(item => ({
        videoId: item.snippet.resourceId.videoId,
        title: item.snippet.title
      }));
      renderPlaylist();
      initPlayer();
    } catch (e) {
      playlistElement.innerHTML = `<li>載入播放清單失敗，請稍後再試</li>`;
      console.error(e);
    }
  }

  function renderPlaylist() {
    playlistElement.innerHTML = '';
    videos.forEach((v, i) => {
      const li = document.createElement('li');
      li.textContent = v.title;
      li.classList.toggle('active', i === currentIndex);
      li.addEventListener('click', () => {
        playVideoAt(i);
      });
      playlistElement.appendChild(li);
    });
  }

  function initPlayer() {
    if (player) {
      player.loadVideoById(videos[currentIndex].videoId);
      return;
    }
    player = new YT.Player('player', {
      height: '0',
      width: '0',
      videoId: videos[currentIndex].videoId,
      events: {
        onReady: onPlayerReady,
        onStateChange: onPlayerStateChange
      }
    });
  }

  function onPlayerReady(event) {
    player.setVolume(volumeRange.value);
  }

  function onPlayerStateChange(event) {
    if (event.data == YT.PlayerState.ENDED) {
      nextVideo();
    } else if (event.data == YT.PlayerState.PLAYING) {
      isPlaying = true;
      playPauseBtn.textContent = '⏸️ 暫停';
      startAutoPauseTimer();
    } else {
      isPlaying = false;
      playPauseBtn.textContent = '▶️ 播放';
      clearAutoPauseTimer();
    }
  }

  function playVideoAt(index) {
    currentIndex = index;
    player.loadVideoById(videos[currentIndex].videoId);
    renderPlaylist();
  }

  function prevVideo() {
    currentIndex = (currentIndex - 1 + videos.length) % videos.length;
    playVideoAt(currentIndex);
  }

  function nextVideo() {
    currentIndex = (currentIndex + 1) % videos.length;
    playVideoAt(currentIndex);
  }

  playPauseBtn.addEventListener('click', () => {
    if (!player) return;
    const state = player.getPlayerState();
    if (state === YT.PlayerState.PLAYING) {
      player.pauseVideo();
    } else {
      player.playVideo();
    }
  });

  prevBtn.addEventListener('click', prevVideo);
  nextBtn.addEventListener('click', nextVideo);

  volumeRange.addEventListener('input', () => {
    if (player) player.setVolume(volumeRange.value);
  });

  // 播放進度控制
  let isSeeking = false;

  progress.addEventListener('input', () => {
    if (player && player.getDuration) {
      const duration = player.getDuration();
      const seekTo = (progress.value / 100) * duration;
      player.seekTo(seekTo, true);
    }
  });

  progress.addEventListener('mousedown', () => {
    isSeeking = true;
  });

  progress.addEventListener('mouseup', () => {
    isSeeking = false;
  });

  // 用 setInterval 定時更新播放進度與時間顯示
  setInterval(() => {
    if (!player || !player.getDuration || isSeeking) return;
    const duration = player.getDuration();
    if (duration === 0) {
      currentTimeDisplay.textContent = '00:00:00 / 00:00:00';
      progress.value = 0;
      return;
    }
    const currentTime = player.getCurrentTime();
    currentTimeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration)}`;
    progress.value = (currentTime / duration) * 100;
  }, 1000);

  function formatTime(seconds) {
    seconds = Math.floor(seconds);
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = seconds % 60;
    return [h, m, s].map(v => String(v).padStart(2, '0')).join(':');
  }

  // 自動暫停設定
  function getAutoPauseSeconds() {
    const h = parseInt(autoPauseHour.value) || 0;
    const m = parseInt(autoPauseMinute.value) || 0;
    const s = parseInt(autoPauseSecond.value) || 0;
    return h * 3600 + m * 60 + s;
  }

  function startAutoPauseTimer() {
    clearAutoPauseTimer();
    const totalSeconds = getAutoPauseSeconds();

    if (totalSeconds <= 0) {
      enableAutoPauseInputs(true);
      return;
    }

    let remaining = totalSeconds;
    enableAutoPauseInputs(false);
    updateAutoPauseInputs(remaining);

    countdownInterval = setInterval(() => {
      remaining--;
      if (remaining <= 0) {
        clearInterval(countdownInterval);
        countdownInterval = null;
        if (player && isPlaying) {
          player.pauseVideo();
          isPlaying = false;
          playPauseBtn.textContent = '▶️ 播放';
        }
        enableAutoPauseInputs(true);
        resetAutoPauseInputs();
      } else {
        updateAutoPauseInputs(remaining);
      }
    }, 1000);
  }

  function clearAutoPauseTimer() {
    if (autoPauseTimer) {
      clearTimeout(autoPauseTimer);
      autoPauseTimer = null;
    }
    if (countdownInterval) {
      clearInterval(countdownInterval);
      countdownInterval = null;
    }
  }

  function updateAutoPauseInputs(seconds) {
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = seconds % 60;
    autoPauseHour.value = h;
    autoPauseMinute.value = m;
    autoPauseSecond.value = s;
  }

  function resetAutoPauseInputs() {
    autoPauseHour.value = 0;
    autoPauseMinute.value = 0;
    autoPauseSecond.value = 0;
  }

  function enableAutoPauseInputs(enable) {
    autoPauseHour.disabled = !enable;
    autoPauseMinute.disabled = !enable;
    autoPauseSecond.disabled = !enable;
    startAutoPauseBtn.disabled = !enable;
    startAutoPauseBtn.style.color = enable ? '' : '#ccc';
    startAutoPauseBtn.style.cursor = enable ? 'pointer' : 'default';
  }

  startAutoPauseBtn.addEventListener('click', () => {
    clearAutoPauseTimer();
    startAutoPauseTimer();
  });

  // 全螢幕按鈕
  fullscreenBtn.addEventListener('click', () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
    } else if (document.exitFullscreen) {
      document.exitFullscreen();
    }
  });

  // 更新現在時間顯示
  function updateTime() {
    const now = new Date();
    const hh = String(now.getHours()).padStart(2, '0');
    const mm = String(now.getMinutes()).padStart(2, '0');
    const ss = String(now.getSeconds()).padStart(2, '0');
    timeElement.textContent = `⌚ 現在時間：${hh}:${mm}:${ss}`;
  }
  setInterval(updateTime, 1000);
  updateTime();

  // 自動更新播放清單每5分鐘
  setInterval(() => {
    loadPlaylist();
  }, 300000);

</script>

<script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
